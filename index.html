<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    
    <title>Ultimate Biller Hub</title>
    
    <link rel="stylesheet" href="./src/css/theme.css">
    <link rel="stylesheet" href="./src/css/styles.css">
    <link rel="stylesheet" href="./src/css/notes.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
      .debug-log {
        position: fixed;
        bottom: 10px;
        left: 10px;
        width: clamp(300px, 40vw, 450px);
        max-height: 250px;
        background-color: rgba(22, 27, 34, 0.9);
        color: #79c0ff;
        font-family: monospace;
        font-size: 12px;
        border-radius: var(--radius-md);
        padding: 0.75rem;
        overflow-y: auto;
        z-index: 9999;
        border: 1px solid var(--card-border);
        box-shadow: 0 8px 16px var(--shadow-color);
        opacity: 0;
        transform: translateY(10px);
        pointer-events: none;
        transition: opacity 0.2s ease-out, transform 0.2s ease-out;
      }
      .debug-log:not([hidden]) {
        opacity: 1;
        transform: translateY(0);
      }
      .debug-log p {
        margin: 0 0 4px;
        padding: 0 0 4px;
        border-bottom: 1px dotted #30363d;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .debug-log p:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
    </style>
</head>
<body>

    <header class="app-header" role="banner">
        <h1 class="app-title">Ultimate Biller Hub</h1>
        <div class="header-actions">
            <button id="themeToggleBtn" class="icon-btn" aria-label="Toggle theme" data-tooltip="Toggle Theme" data-shortcut="T"><i class="fa-solid fa-sun"></i></button>
            <button id="favoritesBtn" class="icon-btn" aria-label="Show Favorites" data-tooltip="Toggle Favorites Panel" data-shortcut="F"><i class="fa-solid fa-star"></i></button>
            <button id="directoryBtn" class="icon-btn" aria-label="Open Biller Directory" data-tooltip="Biller Directory" data-shortcut="D"><i class="fa-solid fa-book-bookmark"></i></button>
            <button id="toolsBtn" class="icon-btn" aria-label="Open Workplace Tools" data-tooltip="Workplace Tools" data-shortcut="W"><i class="fa-solid fa-toolbox"></i></button>
            <div class="popover-wrapper">
                <button id="settingsBtn" class="icon-btn" aria-label="Open Settings" aria-haspopup="true" aria-expanded="false" data-tooltip="Settings">
                    <i class="fa-solid fa-cog"></i>
                </button>
                <div id="settingsPopover" class="popover" hidden>
                    <div class="popover-header">Settings</div>
                    <div class="popover-content">
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleAreaZipUI">
                            <span class="switch-label">Show Area/ZIP Tool</span>
                            <div class="switch-track"><div class="switch-handle"></div></div>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleSuggestions" checked>
                            <span class="switch-label">Enable Suggestions</span>
                            <div class="switch-track"><div class="switch-handle"></div></div>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleCompactDensity">
                            <span class="switch-label">Compact Density</span>
                            <div class="switch-track"><div class="switch-handle"></div></div>
                        </label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleAnalytics" checked>
                            <span class="switch-label">Show Analytics</span>
                            <div class="switch-track"><div class="switch-handle"></div></div>
                        </label>
                        <hr style="border-color: var(--card-border); margin: 0.5rem 0;">
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleDebugLog">
                            <span class="switch-label">Show Debug Log</span>
                            <div class="switch-track"><div class="switch-handle"></div></div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="app-main" role="main">
        <div id="notificationBanner" class="notification-banner" role="alert" hidden></div>

        <div class="main-content-grid">
            <div class="content-primary">
                <section class="search-container" aria-labelledby="search-heading">
                    <h2 id="search-heading" class="sr-only">Search for Billers</h2>
                    <div id="searchWrapper" class="search-wrapper" role="combobox" aria-haspopup="listbox" aria-expanded="false">
                        <i class="fa-solid fa-magnifying-glass search-icon" aria-hidden="true"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search by name, TLA, or alias..." aria-autocomplete="list" aria-controls="suggestionsList" aria-label="Search input">
                        <ul id="suggestionsList" class="suggestions-list" role="listbox" hidden></ul>
                    </div>
                </section>
                <section id="billerCard" class="biller-card" aria-live="polite" hidden></section>
                <section id="locationCard" class="biller-card" aria-live="polite" hidden></section>
            </div>

            <aside class="content-secondary" aria-labelledby="sidebar-heading">
                <h2 id="sidebar-heading" class="sr-only">Sidebar Tools and Information</h2>
                <section id="favoritesSection" class="favorites-section" aria-labelledby="favorites-heading">
                    <h3 id="favorites-heading">Your Favorites</h3>
                    <ul id="favoritesList" role="list"></ul>
                </section>
                <section id="areaZipLookup" class="area-zip-lookup" hidden>
                    <h3 class="area-zip-heading">Area/Zip Lookup</h3>
                    <div id="locationLookupWrapper" class="lookup-wrapper">
                        <div class="lookup-form">
                            <input type="tel" id="locationInput" class="menu-input" placeholder="Enter code..." aria-label="Location input" autocomplete="off">
                        </div>
                        <ul id="locationSuggestionsList" class="suggestions-list" role="listbox" hidden></ul>
                    </div>
                    <div id="locationResultsBox" class="location-results-box" hidden></div>
                </section>
                <section id="analyticsDiv" class="analytics-dashboard" aria-labelledby="analytics-heading">
                    <h3 id="analytics-heading">Usage Analytics</h3>
                    <canvas id="analyticsChart"></canvas>
                </section>
            </aside>
        </div>
    </main>

    <div id="directoryModal" class="modal-overlay" hidden>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="directory-header">
            <div class="modal-header">
                <h2 id="directory-header">Biller Directory</h2>
                <button id="directoryCloseBtn" class="icon-btn" aria-label="Close Directory"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="directoryModalList" class="modal-body"></div>
        </div>
    </div>

    <aside id="toolsPanel" class="drawer" role="complementary" aria-labelledby="tools-header"></aside>

    <template id="toolsPanelTemplate">
        <div class="drawer-header">
            <h2 id="tools-header" class="drawer-title">Workplace Tools</h2>
            <button id="toolsCloseBtn" class="icon-btn" aria-label="Close Tools Panel"><i class="fa-solid fa-times"></i></button>
        </div>
        <div class="drawer-content">
            <section aria-labelledby="kb-heading">
                <h3 id="kb-heading">KB Articles</h3>
                <div class="search-wrapper">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    <input type="text" id="toolsKbSearch" class="menu-input" placeholder="Search articles...">
                </div>
                <ul id="kbList" class="kb-list"></ul>
            </section>
        </div>
    </template>
    
    <div id="debugLog" class="debug-log" hidden></div>

    <script src="./src/js/lib/fuse.min.js"></script>
    <script src="./src/js/data/kb-articles.js"></script>
    <script src="./src/js/data/locations.js"></script>
    <script src="./src/js/core/utils.js"></script>
    <script src="./src/js/core/db.js"></script>
    <script src="./src/js/core/virtual-list.js"></script>
    <script src="./src/js/core/app-core.js"></script>
    <script src="./src/js/core/data-helpers.js"></script>
    <script src="./src/js/features/location-feature.js"></script>
    <script src="./src/js/features/notes-feature.js"></script>
    <script src="./src/js/features/app-features.js"></script>
    <script src="./src/js/ui/ui-notes.js"></script>
    <script src="./src/js/ui/ui-components.js"></script>
    <script src="./src/live/BGE.js"></script>
    <script src="./src/js/main/app-main.js"></script>
    
</body>
</html>
